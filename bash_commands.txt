###ADC###
export GOOGLE_APPLICATION_CREDENTIALS=service_account_key.json
###iot_devices.py###
PROJECT_ID=$(gcloud config list project --format "value(core.project)")
python iot_devices.py --project=$PROJECT_ID

###streaming_count.py###
#local runner
python streaming_count.py \
	--input_topic taxi_rides \
	--project=vijays-sandbox

#cloud runner
PROJECT_ID=$(gcloud config list project --format "value(core.project)")
BUCKET=$PROJECT_ID # CHANGE AS NECCESSARY 

python streaming_count.py \
	--input_topic taxi_rides \
	--runner=DataflowRunner \
	--project=$PROJECT_ID \
	--temp_location=gs://$BUCKET/dataflow_streaming

###BQ TABLE SCHEMA###
[
    {
        "name": "trips_last_5min",
        "type": "INTEGER",
        "mode": "REQUIRED"
    },
    {
        "name": "time",
        "type": "TIMESTAMP",
        "mode": "REQUIRED"
    }
]

###BQ DELETE OLD DATA###
DELETE
FROM
  `taxifare.traffic_realtime`
WHERE
  TIMESTAMP_DIFF(CURRENT_TIMESTAMP,time,HOUR) > 12